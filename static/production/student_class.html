<!DOCTYPE html> 
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>考试后台管理系统</title>
    <script src="../exam/js/config.js"></script>
    <!-- jQuery -->
    
    <script type="text/javascript" charset="utf8" src="../exam/js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/js/jquery.js"></script>
	<!-- DataTables -->
	<link rel="stylesheet" type="text/css" href="../exam/css/jquery.dataTables.css">
	<script type="text/javascript" charset="UTF-8" src="../exam/js/jquery.dataTables.js"></script>
	<script src="../exam/js/bootstrap.min.js"></script>
	<script src="../exam/js/handlebars-v3.0.1.js"></script>

	<!--DataTablesButtons-->
	<link rel="stylesheet" href="../exam/Buttons-1.5.1/css/buttons.dataTables.min.css">
	<script type="text/javascript" charset="utf8" src="../exam/Buttons-1.5.1/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/Buttons-1.5.1/js/buttons.html5.min.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/Buttons-1.5.1/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/Buttons-1.5.1/js/buttons.print.js"></script>
    
    	
    <!-- Bootstrap -->   
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">
    <link href="../vendors/select2/dist/css/select2.min.css" rel="stylesheet">
    
    <!--侧边栏-->
  	<!--<script src="../exam/js/menu.js"></script>-->
  	

    <!-- Bootstrap -->
    <!--<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>-->
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>
    <script src="../vendors/select2/dist/js/select2.full.min.js"></script>
    
    <!--<script src="../exam/js/AuthorityManagement.js"></script><-->			<!--权限控制session-->
  
    <style>
    table {
        *border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        border: 1px solid #ccc;
        text-decoration: none;
        table-layout: fixed;
    }

    .zebra td,
    .zebra th {
        padding: 10px;
        /*border-bottom: 1px solid #f2f2f2;*/
        border-left: 1px solid #ccc;
        border-top: 1px solid #ccc;
        text-align: center;
    }

    .zebra .alternate,
    .zebra tbody tr:nth-child(even) {
        background: #f5f5f5;
        box-shadow: 0 1px 0 rgba(255, 255, 255, .8) inset;
    }

    .zebra th {
        text-align: center;
        text-shadow: 0 1px 0 rgba(255, 255, 255, .5);
        border-bottom: 1px solid #ccc;
        background-color: #eee;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#f5f5f5), to(#eee));
        background-image: -webkit-linear-gradient(top, #f5f5f5, #eee);
        background-image: -moz-linear-gradient(top, #f5f5f5, #eee);
        background-image: -ms-linear-gradient(top, #f5f5f5, #eee);
        background-image: linear-gradient(top, #f5f5f5, #eee);
        filter: progid: DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#f5f5f5, endColorstr=#eee);
        -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#f5f5f5,endColorstr=#eee)";
    }

    .zebra th:last-child {
        border-radius: 0 6px 0 0;
        width: 12%;
    }

    .zebra tr:last-child td:first-child {
        border-radius: 0 0 0 6px;
    }

    .zebra td:last-child {
        border-radius: 0 0 6px 0;
    }

    .pageNumber {
        margin-top: 20px;
        padding: 10px;
        border-radius: 5px;
        background: #dddddd;
        height: 40px;
        width: auto;
    }

    td {
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
        text-align: center;
    }

    .td0 {
        width: 10%;
        text-align: left;
    }

    .td1 {
        width: 12%;
    }

    a {
        cursor: pointer;
    }

    .modal-footer {
        margin-top: 20px;
        padding: 5px;
        border-radius: 5px;
        height: 40px;
        width: auto;
        float: left;
    }
    .information{
        margin-bottom: -25px;
        height: 30px;
    }
    </style>
    <style>
    ul.pagination {
        display: inline-block;
        padding: 0;
        margin: 0;
        float: right;
    }

    ul.pagination li {
        display: inline;
    }

    ul.pagination li a {
        color: black;
        float: right;
        padding: 8px 16px;
        text-decoration: none;
        transition: background-color .3s;
        border: 1px solid #ddd;
    }

    ul.pagination li a.active {
        background-color: #4CAF50;
        color: white;
        border: 1px solid #4CAF50;
    }

    ul.pagination li a:hover:not(.active) {
        background-color: #ddd;
    }
    </style>
</head>

<body class="nav-md"  style="background-image: url(../vendors/tushuguan.jpg);background-repeat: no-repeat;background-size: cover;">
    <div class="container body">
        <div class="main_container" >
            <div id="menu">
             <!--加载侧边栏-->
            </div>
            <!-- page content -->
            <div class="right_col" role="main">
                <div class="">
                    <div class="page-title">
                        <div class="title_left">
                            <h3>教务班管理</h3>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>添加或查询教务班</h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li>
                                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <form class="form-horizontal form-label-left" id="class_data">
                                        <div class="form-group">
                                            <label class="control-label col-md-1 col-sm-3 col-xs-12">教学班名</label>
                                            <div class="col-md-3">
                                                <input type="text" id="cl_name" class="form-control" name="cl_name" placeholder="教学班名" required="required">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-9 col-md-offset-1">
                                                <button type="button" id="create" class="btn btn-success">新建</button>
                                                <button type="button" id="search" class="btn btn-dark">查询</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>教务班列表</h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li>
                                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class="class_list">
                                        <table class="zebra bulk_action" id="table_class"> 
                                            <thead>
	                                            <tr>
	                                                <th class="td0">教务班号</th>
	                                                <th>教务班名</th>
	                                                <th>操作</th>
	                                            </tr>
	                                        </thead>
                                            <tbody id="all_class">
                                            </tbody>
                                        </table>
                                    </div>
                                    <div>
                                        <ul class="pagination" id="page-list">
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12" id="all_student">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>教务班详情</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <table class="zebra bulk_action" id="class_details">
                                    <thead>
                                        <tr>
                                            <th class="td0">班级</th>
                                            <th>学号</th>
                                            <th>姓名</th>
                                            <th>性别</th>
                                            <th>联系方式</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="studentList">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /page content -->
    </div>
    </div>
    <div class="modal fade" id="myModal_modify_student" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">修改学生信息</h4></div>
                <div class="modal-body">
                    <form class="form-horizontal form-label-left" id="form_data_modify">
                        <div class="form-group">
                            <label class="control-label col-md-3">班级</label>
                            <div class="col-md-5">
                                <input type="text" id="student_specialty_modify" class="form-control" name="st_specialty" placeholder="班级">
                            </div>
                        </div>
                        <div class="form-group" style="display:none;">
                            <label class="control-label col-md-3">学号</label>
                            <div class="col-md-5">
                                <input type="text" id="student_id_modify" class="form-control" name="st_id" placeholder="学号">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3">名字</label>
                            <div class="col-md-5">
                                <input type="text" id="student_name_modify" class="form-control" name="st_name" placeholder="名字">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3">性别</label>
                            <div class="col-md-5">
                                <input type="text" id="student_sex_modify" class="form-control" name="st_sex" placeholder="性别">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3">联系方式</label>
                            <div class="col-md-5">
                                <input type="text" id="student_contact_way_modify" class="form-control" name="st_phone" placeholder="联系方式">
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-primary" style="margin-left: 30%;margin-top: 10px;" data-dismiss="modal" id="submit_modify_student" onclick="submit_modify(this)">提交更改</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
	<!--定义查看按钮-->
	<script id="tpl" type="text/x-handlebars-template">
		{{#each func}}
		<button type="button" class="btn btn-{{this.type}} btn-sm" onclick="{{this.fn}}">{{this.name}}</button> {{/each}}
	</script>
	<!--定义删除操作按钮-->
	<script id="tp2" type="text/x-handlebars-template">
		{{#each func}}
		<button type="button" class="btn btn-{{this.type}} btn-sm" data-toggle="modal" data-target="#myModal" onclick="{{this.fn}}">{{this.name}}</button> {{/each}}
	</script>
	<!--定义删除(教务办详情)操作按钮-->
	<script id="tp3" type="text/x-handlebars-template">
		{{#each func}}
		<button type="button" class="btn btn-{{this.type}} btn-sm" data-toggle="modal" data-target="#myModal" onclick="{{this.fn}}">{{this.name}}</button> {{/each}}
	</script>
	
	<script src="../exam/js/menu.js"></script>
        
    <script type="text/javascript">
    	$(function () 
		 {
    		$.ajax
			({
	      	    url: "" + ServerIp + "/StudentManage/Menu", //加上这句话
	            type: 'POST',				//请求的类型
	            async: false,
	            dataType: "text",			//数据类型		          
	            data: {					         		            
	            },					            
	            success:function(data) 	 //操作后台的返回值
	            {
	            	//alert(data);
	            	data = JSON.parse(data);		           
	            	$("#menu").append(data);		            	
				},
	            error: function(e)
	            {
	            	alert("error");
	            }
		    });
		})
    </script>	
	
	
    <script>
    var currentPage = 1;
    var totalPage = 0;
   
    $(document).ready(function() {
        
        myFunction();
    });
	
	function DestroyTable_class()//清除datatable表格内容以供刷新
    {
    	var datatable = $("#table_class").dataTable();
    	if (datatable) 
    	{
         	datatable.fnClearTable();    //清空数据
         	datatable.fnDestroy();         //销毁datatable
   	 	} 

    }
	function DestroyTable_student()//清除datatable表格内容以供刷新
    {
    	var datatable = $("#class_details").dataTable();
    	if (datatable) 
    	{
         	datatable.fnClearTable();    //清空数据
         	datatable.fnDestroy();         //销毁datatable
   	 	} 

    }
    // 填充教务班表
    function myFunction() {

			$("#all_student").hide();	
			document.getElementById("all_class").innerHTML='';
			//定义按钮模板
			var tpl = $("#tpl").html();
			var tp2 = $("#tp2").html();			
			
			//预编译模板
			var template1 = Handlebars.compile(tpl);
			var template2 = Handlebars.compile(tp2);
			$.ajax({
				type: 'POST', //请求的类型
				url: "" + ServerIp + "/StudentManage/ManageClass",
				async:false,
				dataType:"text",
				data:{"currentPage": currentPage},
				success:function(data)
				{
					data=JSON.parse(data);
					data=data.body;
					var pageList = $('.pagination');
		            totalPage = data.totalPage;
		            var pageSize = data.pageSize;
		            var firstPage = data.firstPage;
		            var lastPage = data.lastPage;
		            document.getElementById("page-list").innerHTML = '';
		            if (lastPage) {
		                pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
		            } else {
		                pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
		            }
		            pageList.append('<li><a id = "student_class' + totalPage + '" onclick="trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
		            if (totalPage > 1) {
		                if (totalPage - currentPage >= 2) {
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                }
		                if (currentPage > 1 && currentPage != totalPage) {
		                    pageList.append('<li ><a id = "student_class' + currentPage + '" chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                } else {
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                }
		                pageList.append('<li ><a id = student_class' + 1 + ' chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
		            }
		            document.getElementById("student_class" + currentPage + "").style.background = "#426384";
		            if (firstPage) {
		                pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
		            } else {
		                pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
		            }
		            pageList.append('<input style="width:50px;height:30px;margin-top:5px;margin-right:20px;" id="page_num"></input>');
		            pageList.append('<li onclick = "turing_page()"><a href="#">翻页</a></li>');
					table=$('#table_class').DataTable({
						data: data.data,
						"paging": false, //禁止分页
						retrieve: true, //实例化检索
						"columns": [
								{
									data: 'cl_id'
							    },
							    {
									data: 'cl_name'
							    },
								{
									data: null//占位空列
								} 
							],
							"columnDefs": 
							[
								{
									"searchable": false,
									"orderable": false,
									"targets": [0. - 1]					// 表格填充的范围,[0,-1]为所有
								},
								{
									"targets": 2,
									"render": function(a, b, c, d) 
									{
										var context1 =
											{
												func: 
												[
													{
														"name": "查看",
														"fn": "check_class_student(\'" + c.cl_id + "\')",
														"type": "danger"
														
													}, //添加按键     name为按键属性
												]
											};
											var html1 = template1(context1);
											var context2 = 
											{
												func: 
												[
													{
														"name": "删除",
														"fn":"delete_class(\'" + c.cl_id + "\')",
														"type": "primary"
													},
												]
											};						
											var html2 = template2(context2);
										return html1 + html2;
									}
								},
							]
					});
				}
			});
	}
   
//
//          var pageList = $('.pagination');
//          totalPage = data.body.totalPage;
//          var pageSize = data.body.pageSize;
//          var firstPage = data.body.firstPage;
//          var lastPage = data.body.lastPage;
//          document.getElementById("page-list").innerHTML = '';
//          if (lastPage) {
//              pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
//          } else {
//              pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
//          }
//          pageList.append('<li><a id = "student_class' + totalPage + '" onclick="trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
//          if (totalPage > 1) {
//              if (totalPage - currentPage >= 2) {
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              }
//              if (currentPage > 1 && currentPage != totalPage) {
//                  pageList.append('<li ><a id = "student_class' + currentPage + '" chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              } else {
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              }
//              pageList.append('<li ><a id = student_class' + 1 + ' chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
//          }
//          document.getElementById("student_class" + currentPage + "").style.background = "#426384";
//          if (firstPage) {
//              pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
//          } else {
//              pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
//          }
//          pageList.append('<input style="width:50px;height:30px;margin-top:5px;margin-right:20px;" id="page_num"></input>');
//          pageList.append('<li onclick = "turing_page()"><a href="#">翻页</a></li>');
//      });
//  }
   
    $('#page-list').on("click", "#nextpage", function() {
        currentPage += 1;
        if ($('#cl_name').val() == '') {
        	DestroyTable_class();
            myFunction();
        } else {
        	DestroyTable_class();
            myfunction1();
        }
    });
    $('#page-list').on("click", "#lastpage", function() {
        currentPage -= 1;
        if ($('#cl_name').val() == '') {
        	DestroyTable_class();
            myFunction();
        } else {
        	DestroyTable_class();
            myfunction1();
        }
    });
    $('#page-list').on("click", "#Page1", function() {
        currentPage = 1;
        if ($('#cl_name').val() == '') {
        	DestroyTable_class();
            myFunction();
        } else {
        	DestroyTable_class();
            myfunction1();
        }
    });

    function turing_page() {
        if ($("#page_num").val() > totalPage || $("#page_num").val() == '' || !Number.isInteger(Number($("#page_num").val()))) {
            alert("页码有误");
            return;
        }
        currentPage = $("#page_num").val();
        if ($('#cl_name').val() == '') {
        	DestroyTable_class();
            myFunction();
        } else {
        	DestroyTable_class();
            myfunction1();
        }

    }

    function trailerPage(totalPage) {
        currentPage = totalPage;
        if ($('#cl_name').val() == '') {
        	DestroyTable_class();
            myFunction();
        } else {
        	DestroyTable_class();
            myfunction1();
        }

    }
    
    $('button#create').click(function() {
        if ($('#cl_name').val() == '') {
            alert('请输入教学班！！！');
            return false;
        }
        $.post("" + ServerIp + "/StudentManage/AddClass", {
            "cl_name": $('#cl_name').val()
        }, function(data) {
        	alter("新建成功");
            window.location.reload();
            // var data = JSON.parse(data);
        });
    })
    
    function myfunction1()
    {
    	$("#all_student").hide();	
			document.getElementById("all_class").innerHTML='';
			//定义按钮模板
			var tpl = $("#tpl").html();
			var tp2 = $("#tp2").html();	
			alert($('#cl_name').val());
			
			//预编译模板
			var template1 = Handlebars.compile(tpl);
			var template2 = Handlebars.compile(tp2);
			$.ajax({
				type: 'POST', //请求的类型
				url: "" + ServerIp + "/StudentManage/QueryClass",
				async:false,
				dataType:"text",
				data:{
					"cl_name": $('#cl_name').val(),
					"currentPage": currentPage
				},
				success:function(data)
				{
					data=JSON.parse(data);
					data=data.body;
					var pageList = $('.pagination');
		            totalPage = data.totalPage;
		            var pageSize = data.pageSize;
		            var firstPage = data.firstPage;
		            var lastPage = data.lastPage;
		            document.getElementById("page-list").innerHTML = '';
		            if (lastPage) {
		                pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
		            } else {
		                pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
		            }
		            pageList.append('<li><a id = "student_class' + totalPage + '" onclick="trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
		            if (totalPage > 1) {
		                if (totalPage - currentPage >= 2) {
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                }
		                if (currentPage > 1 && currentPage != totalPage) {
		                    pageList.append('<li ><a id = "student_class' + currentPage + '" chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                } else {
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                }
		                pageList.append('<li ><a id = student_class' + 1 + ' chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
		            }
		            document.getElementById("student_class" + currentPage + "").style.background = "#426384";
		            if (firstPage) {
		                pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
		            } else {
		                pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
		            }
		            pageList.append('<input style="width:50px;height:30px;margin-top:5px;margin-right:20px;" id="page_num"></input>');
		            pageList.append('<li onclick = "turing_page()"><a href="#">翻页</a></li>');
		           
					table=$('#table_class').DataTable({
						data: data.data,
						"paging": true, //禁止分页
						retrieve: true, //实例化检索
						"columns": [
								{
									data: 'cl_id'
							    },
							    {
									data: 'cl_name'
							    },
								{
									data: null//占位空列
								} 
							],
							"columnDefs": 
							[
								{
									"searchable": false,
									"orderable": false,
									"targets": [0. - 1]					// 表格填充的范围,[0,-1]为所有
								},
								{
									"targets": 2,
									"render": function(a, b, c, d) 
									{
										var context1 =
											{
												func: 
												[
													{
														"name": "查看",
														"fn": "check_class_student(\'" + c.cl_id + "\')",
														"type": "danger"
														
													}, //添加按键     name为按键属性
												]
											};
											var html1 = template1(context1);
											var context2 = 
											{
												func: 
												[
													{
														"name": "删除",
														"fn":"delete_class(\'" + c.cl_id + "\')",
														"type": "primary"
													},
												]
											};						
											var html2 = template2(context2);
										return html1 + html2;
									}
								},
							]
					});
				}
			});
    }
    /*
    // 有条件的填充教务班表
    function myfunction1() {
        $.post("" + ServerIp + "/StudentManage/QueryClass", {
            "cl_name": $('#cl_name').val(),
            "currentPage": currentPage
        }, function(data) {
            // alert(data);
            var data = JSON.parse(data);
            var m = 0;
            document.getElementById("all_class").innerHTML = '';
            while (data.body.data[m] != null) {
                $("tbody#all_class").append('<tr><td>' + data.body.data[m].cl_id + '</td><td>' + data.body.data[m].cl_name + '</td><td><a onclick = "check_class_student(this)" cl_id = ' + data.body.data[m].cl_id + ' style="margin-right:10px;" href="#">查看</a><a href="#" onclick = "delete_class(this)" cl_id = ' + data.body.data[m].cl_id + '>删除</a></td></tr>');
                m++;
            }
            var pageList = $('.pagination');
            totalPage = data.body.totalPage;
            var pageSize = data.body.pageSize;
            var firstPage = data.body.firstPage;
            var lastPage = data.body.lastPage;
            document.getElementById("page-list").innerHTML = '';
            if (lastPage) {
                pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
            } else {
                pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
            }
            pageList.append('<li><a id = questionback' + totalPage + ' onclick="trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
            if (totalPage > 1) {
                if (totalPage - currentPage >= 2) {
                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                }
                if (currentPage > 1 && currentPage != totalPage) {
                    pageList.append('<li ><a id = questionback' + currentPage + ' chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                } else {
                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                }
                pageList.append('<li ><a id = questionback' + 1 + ' chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
            }
            document.getElementById("questionback" + currentPage).style.background = "#426384";
            if (firstPage) {
                pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
            } else {
                pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
            }
            pageList.append('<input style="width:50px;height:30px;margin-top:5px;margin-right:20px;" id="page_num"></input>');
            pageList.append('<li onclick = "turing_page()"><a href="#">翻页</a></li>');
        });
    }
    */
    $('button#search').click(function() {
        if ($('#cl_name').val() == '') {
            alert('请输入教学班名!');
            return false;
        } else {
            currentPage = 1;
            myfunction1();
        }
    });


	function check_class_student(cl_id)
		{
			
			DestroyTable_student();
			//alert(cl_id);
			$("#all_student").show();
//			$("#all_student").dataTable().fnDestroy();
//			loadTable();
			var tp3 = $("#tp3").html();
			var template1 = Handlebars.compile(tp3);
			var data={
				'cl_id':cl_id,
			}

			$.ajax({
				type:'POST',
				url:"" + ServerIp + "/StudentManage/OpenClass",
				async:false,
				dataType:"text",
				data:{"cl_id":cl_id},
				success:function(data)
				{
					
					if(typeof data=='string')
						var data = JSON.parse(data);
					switch(data.status){
						case 1:
							{
								//data = data.body;
								table=$('#class_details').DataTable({
								
								data: data.body,
								"paging": false, //禁止分页
								retrieve: true, //实例化检索
								"columns": [
									{
										data: 'st_specialty'
								    },
								    {
										data: 'st_id'
								    },
								    {
										data: 'st_name'
								    },
								    {
										data: 'st_sex'
								    },
								    {
										data: 'st_phone'
								    },
									{
										data: null//占位空列
									} 
								],
								"columnDefs": 
									[
										{
											"searchable": false,
											"orderable": false,
											"targets": [0. - 1]					// 表格填充的范围,[0,-1]为所有
										},
										{
											"targets": 5,
											"render": function(a, b, c, d) 
											{	
													var context1 =
													{
														func: 
														[
															{
																"name": "删除",
																"fn": "delete_student(\'" + c.st_id + "\',\'" + cl_id + "\')",
																"type": "danger"
																
															}, //添加按键     name为按键属性
														]
													};
													var html1 = template1(context1);
													
												return html1;
											}
											
										},
									]
							});
						break;
						}
						case 2:
		                    alert("参数错误!");
		                    break;
		                case 6:
		                    alert("该班级未添加学生!");
		                    break;
		                default:
		                    alert("发生未知错误!");
		                    break;
							
					}
					
				}
			});
		}
	
    function delete_class(cl_id) {


        var password = prompt('请输入管理员密码', '');
        if (password == '' || typeof(password) == 'undefined' || password == null) {
            alert('您输入的管理员密码有误');
        } else {
            var data = {
				'cl_id':cl_id,
                'deletepassword': password
            }
            $.post("" + ServerIp + "/StudentManage/DeleteClass", data, function(data) {
                var data = JSON.parse(data);
                if (data.status == 1) {
                	alert("删除成功");
                    window.location.reload();
                } else {
                    alert(data.message);
                }
            });
        }
    }
/*
    function modify_student(obj) {
        var st_specialty = $(obj).attr("st_specialty");
        var st_id = $(obj).attr("st_id");
        var st_name = $(obj).attr("st_name");
        var st_sex = $(obj).attr("st_sex");
        var st_phone = $(obj).attr("st_phone");

        $("input#student_specialty_modify").val(st_specialty);
        $("input#student_id_modify").val(st_id);
        $("input#student_name_modify").val(st_name);
        $("input#student_sex_modify").val(st_sex);
        $("input#student_contact_way_modify").val(st_phone);
        $('#myModal_modify_student').modal('show');
        $("button#submit_modify_student").click(function() {
            var data = {};
            $("form#form_data_modify").serializeArray().map(function(x) {
                if (data[x.name] !== undefined) {

                    if (!data[x.name].push) {
                        data[x.name] = [data[x.name]];
                    }
                    data[x.name].push(x.value || '');
                } else {
                    data[x.name] = x.value || '';
                }
            });
            $.post("" + ServerIp + "/StudentManage/CheckStudent", data, function(data) {
                var data = JSON.parse(data);
                switch (data.status) {
                    case 0:
                        alert("修改失败!");
                        break;
                    case 1:
                        // alert("修改成功!");
                        window.location.reload();
                        break;
                    case 2:
                        alert("参数错误!");
                        break;
                    default:
                        alert("出现未知错误");
                        break;
                }

            });
        });

    }
*/

	function delete_student(st_id,cl_id)
	{
		$("#all_student").hide();
		$("#all_student").show();
		var tp3 = $("#tp3").html();
		var template3 = Handlebars.compile(tp3);
		if(!confirm("是否删除?")){
                return;
        }
		var id=cl_id;
		$.ajax({
				type:'POST',
				url:"" + ServerIp + "/StudentManage/DeleteStudent",
				async:false,
				dataType:"text",
				data:{
					"st_id":st_id,
					"cl_id":cl_id
					
				},
				success:function(data)
				{
					var data=JSON.parse(data);
					data=data.body;
					
					var status=data.status;
					switch(status)
					{
						case 0:
							alert(data.message);
		                    window.location.reload();
		                    break;
						case 1:
							alert("删除成功！");
							check_class_student(cl_id);
							break;
						case 2:
							alert(data.message);
		                    window.location.reload();
		                    break;
                   		case 7:
		                    alert(data.message);
		                    window.location.reload();
		                    break;
		                default:
		                    alert("发生未知错误!");
		                    window.location.reload();
		                    break;
					}
				}
		});
		alert("学生信息删除成功!");
		DestroyTable_student();
		check_class_student(id);
//		check_class_student(cl_id);
	} 
    </script>
</body>

</html>