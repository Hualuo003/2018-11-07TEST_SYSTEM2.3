<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>考试后台管理系统</title>
    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">
    <style>
    table {
        *border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        border: 1px solid #ccc;
        text-decoration: none;
        table-layout: fixed;
    }

    .zebra td,
    .zebra th {
        padding: 10px;
        /*border-bottom: 1px solid #f2f2f2;*/
        border-left: 1px solid #ccc;
        border-top: 1px solid #ccc;
        text-align: center;
    }

    .zebra .alternate,
    .zebra tbody tr:nth-child(even) {
        background: #f5f5f5;
        box-shadow: 0 1px 0 rgba(255, 255, 255, .8) inset;
    }

    .zebra th {
        text-align: center;
        text-shadow: 0 1px 0 rgba(255, 255, 255, .5);
        border-bottom: 1px solid #ccc;
        background-color: #eee;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#f5f5f5), to(#eee));
        background-image: -webkit-linear-gradient(top, #f5f5f5, #eee);
        background-image: -moz-linear-gradient(top, #f5f5f5, #eee);
        background-image: -ms-linear-gradient(top, #f5f5f5, #eee);
        background-image: linear-gradient(top, #f5f5f5, #eee);
        filter: progid: DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#f5f5f5, endColorstr=#eee);
        -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#f5f5f5,endColorstr=#eee)";
    }
    /*.zebra th:first-child {
        border-radius: 6px 0 0 0;
        width: 50px;
    }*/

    .zebra th:last-child {
        border-radius: 0 6px 0 0;
        width: 120px;
    }

    .zebra tr:last-child td:first-child {
        border-radius: 0 0 0 6px;
    }

    .zebra td:last-child {
        border-radius: 0 0 6px 0;
    }

    .pageNumber {
        margin-top: 20px;
        padding: 10px;
        border-radius: 5px;
        background: #dddddd;
        height: 40px;
        width: auto;
    }

    td {
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
        text-align: center;
    }

    .td0 {
        width: 50%;
        text-align: left;
    }

    .td1 {
        width: 12%;
    }

    a {
        cursor: pointer;
    }
    </style>
    <style>
    ul.pagination {
        display: inline-block;
        padding: 0;
        margin: 0;
        float: right;
    }

    ul.pagination li {
        display: inline;
    }

    ul.pagination li a {
        color: black;
        float: right;
        padding: 8px 16px;
        text-decoration: none;
        transition: background-color .3s;
        border: 1px solid #ddd;
    }

    ul.pagination li a.active {
        background-color: #4CAF50;
        color: white;
        border: 1px solid #4CAF50;
    }

    ul.pagination li a:hover:not(.active) {
        background-color: #ddd;
    }
    </style>
</head>

<body class="nav-md"  style="background-image: url(../vendors/tushuguan.jpg);background-repeat: no-repeat;background-size: cover;">
    <div class="container body">
        <div class="main_container" >
            <div id="menu">
             <!--加载侧边栏-->
            </div>
        <div class="right_col" role="main">
            <div class="">
                <div class="page-title">
                    <div class="title_left">
                        <h3>教师管理</h3>
                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>添加或查询教师</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <form class="form-horizontal form-label-left">
                                    <div class="form-group">
                                        <label class="control-label col-md-1 col-sm-3 col-xs-12">工号</label>
                                        <div class="col-md-3">
                                            <input type="text" class="form-control" placeholder="工号" id="tc_id">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-1 col-sm-3 col-xs-12">姓名</label>
                                        <div class="col-md-3">
                                            <input type="text" class="form-control" placeholder="姓名" id="tc_name">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-1 col-sm-3 col-xs-12">密码</label>
                                        <div class="col-md-3">
                                            <input type="text" class="form-control" id="tc_password" placeholder="密码">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-1 col-sm-3 col-xs-12">权限</label>
                                        <div class="col-md-3" style="float: left;">
                                            <select class="form-control" id="tc_level">
                                                <option value="管理员">管理员</option>
                                                <option value="教师">教师</option>
                                            </select>
                                        </div>
                                    </div>
                                    <br/>
                                </form>
                                <div class="form-group">
                                    <div class="col-md-9 col-md-offset-1">
                                        <button type="button" class="btn btn-success" id="add_teacher">添加</button>
                                        <!--&nbsp;&nbsp;&nbsp;-->
                                        <!--<button type="button" class="btn btn-dark" id="Select_teacher">查询</button>-->
                                    </div>
                                </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>教师详情</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="demo">
                                    <table class="zebra bulk_action" id="tch_tb">
                                    	<thead>
                                        <tr>
                                            <th>工号</th>
                                            <th>姓名</th>
                                            <th>密码</th>
                                            <th>权限</th>
                                            <th>操作</th>
                                        </tr>
                                    	</thead>
                                        <tbody id="tablebody">
                                        </tbody>
                                    </table>
                                </div>
                                <div>
                                    <ul class="pagination" id="page-list">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!--更改教师信息弹出框      设置属性为隐藏-->
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
									&times;
								</button>

							<h3 class="title1" id="myModalLabel">修改教师信息:</h3>
						</div>
						<br/>
						<div class="form-horizontal">
							<div class="form-group">
								<label for="num" class="col-sm-2 control-label">工号</label>
								<div class="col-sm-8">
									<input type="text" class="form-control1" id="num" placeholder="工号不可更改">
								</div>
								<!--<div class="col-sm-2">
										<p class="help-block">Your help text!</p>
									</div>-->
							</div>
							<div class="form-group">
								<label for="name" class="col-sm-2 control-label">姓名</label>
								<div class="col-sm-8">
									<input type="text" class="form-control1" id="name" placeholder="请输入姓名">
								</div>
							</div>
							<div class="form-group">
								<label for="password" class="col-sm-2 control-label">密码</label>
								<div class="col-sm-8">
									<input type="text" class="form-control1" id="password" placeholder="请输入权限">
								</div>
							</div>
							<div class="form-group">
								<label for="level" class="col-sm-2 control-label">权限</label>
	                                <div class="col-md-3" style="float: left;">
	                                    <select class="form-control" id="level">
	                                        <option value="管理员">管理员</option>
	                                        <option value="教师">教师</option>
	                                    </select>
	                                </div>
							</div>
						</div>
						
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>										
							<button type="button" class="btn btn-primary" onclick="replace()">提交更改</button>																			
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal -->
			</div>
			
        </div>
    </div>
    </div>
    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../vendors/nprogress/nprogress.js"></script>
    <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../build/js/custom.min.js"></script>
    <script src="../vendors/select2/dist/js/select2.full.min.js"></script>
    <script src="../exam/js/config.js"></script>
    <!-- jQuery -->
    
    <script type="text/javascript" charset="utf8" src="../exam/js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/js/jquery.js"></script>
	<!-- DataTables -->
	<link rel="stylesheet" type="text/css" href="../exam/css/jquery.dataTables.css">
	<script type="text/javascript" charset="UTF-8" src="../exam/js/jquery.dataTables.js"></script>
	<script src="../exam/js/bootstrap.min.js"></script>
	<script src="../exam/js/handlebars-v3.0.1.js"></script>
    <!--<script src="../exam/js/AuthorityManagement.js"></script>-->
    <!--定义查看按钮-->
	<script id="tpl" type="text/x-handlebars-template">
		{{#each func}}
		<button type="button" class="btn btn-{{this.type}} btn-sm" onclick="{{this.fn}}">{{this.name}}</button> {{/each}}
	</script>
	<!--定义修改操作按钮-->
	<script id="tp2" type="text/x-handlebars-template">
		{{#each func}}
		<button type="button" class="btn btn-{{this.type}} btn-sm" data-toggle="modal" onclick="{{this.fn}}">{{this.name}}</button> {{/each}}
	</script>
	<!--定义删除按钮-->
	<script id="tp3" type="text/x-handlebars-template">
		{{#each func}}
		<button type="button" class="btn btn-{{this.type}} btn-sm" data-toggle="modal" onclick="{{this.fn}}">{{this.name}}</button> {{/each}}
	</script> 
	
	<script src="../exam/js/menu.js"></script>
        
    <script type="text/javascript">
    	$(function () 
		 {
    		$.ajax
			({
	      	    url: "" + ServerIp + "/StudentManage/Menu", //加上这句话
	            type: 'POST',				//请求的类型
	            async: false,
	            dataType: "text",			//数据类型		          
	            data: {					         		            
	            },					            
	            success:function(data) 	 //操作后台的返回值
	            {
	            	//alert(data);
	            	data = JSON.parse(data);		           
	            	$("#menu").append(data);		            	
				},
	            error: function(e)
	            {
	            	alert("error");
	            }
		    });
		})
    </script>
	
    <script>
    var currentPage = 1;
    var totalPage = 0;
    $(document).ready(function() {
        myFunction();
    });
    function DestroyTable()//清除datatable表格内容以供刷新
    {
    	var datatable = $("#tch_tb").dataTable();
    	if (datatable) 
    	{
         	datatable.fnClearTable();    //清空数据
         	datatable.fnDestroy();         //销毁datatable
   	 	} 

    }
        
    $("#Select_teacher").click(function() {
    	DestroyTable();
        myFunction();
    });
    
    $('#add_teacher').click(function() {
        $.post("" + ServerIp + "/Teacher/AddTeacher", {
                "tc_id": $("#tc_id").val(),
                "tc_name": $("#tc_name").val(),
                "tc_password": $("#tc_password").val(),
                "tc_level": $("#tc_level").val()
            },
            function(data) {
                var data = JSON.parse(data);
                if (data.status == 1) {
                	alert("添加成功");
                    $("#tc_id").val("");
                    $("#tc_name").val("");
                    $("#tc_password").val("");
                    DestroyTable();
                    myFunction();
                } else {
                    alert('添加失败,可能是工号已存在');
                }

            })
    });
    function edit_tc(tc_id, tc_name, tc_password, tc_level) {
				/*console.log(tc_id);*/
				editFlag = true;
				$("#myModal").modal("show");
				$("#num").val(tc_id).attr("disabled",true);
				$("#name").val(tc_name);
				$("#password").val(tc_password);
				$("#level").val(tc_level);
			}

	function replace() {
		//alert("更改老师");
		if(!tc_id || !tc_name || !tc_password)
			alert("请输入完整信息");
		else {
			$.ajax({
				url: "" + ServerIp + "/Teacher/UpdateTeacher", //加上这句话
				type: 'POST', //请求的类型
				async: false,
				dataType: "text", //数据类型
				data: {
					"tc_id": $("#num").val(), //向后台发送数据，并在后台判断用户名和密码是否正确，正确则返回true
					"tc_name": $("#name").val(),
					"tc_password": $("#password").val(),
					"tc_level": $("#level").val(),
				},
				success: function(data) //操作后台的返回值
				{
					data = JSON.parse(data);
					if(data.status == 1) //如果前台返回的是True，执行以下操作
					{
						alert("成功修改老师信息");
						location.reload();
						/*table.reload();*/
					} else {
						alert("该用户已存在");
					}
				}
			})
		}
	}
	
	
	
    function delete_teacher(tc_id) {
        var password = prompt('请输入管理员密码', '');
	            if (password == '' || typeof(password) == 'undefined' || password == null || password != 'admin') {
	                alert('您输入的管理员密码有误');
	            } else{
	            $.post("" + ServerIp + "/Teacher/DeleteTeacher", {
                "tc_id": tc_id,
	            },
	            function(data) {
	            	alert('删除成功');
	            	DestroyTable();	            	
	                myFunction();
	            });
	            }
    }
    
    function myFunction() {
    	//定义按钮模板
		var tpl = $("#tpl").html();
		var tp2 = $("#tp2").html();
		var tp3 = $("#tp3").html();				
		
		//预编译模板
		var template = Handlebars.compile(tpl);
		var template2 = Handlebars.compile(tp2);
		var template3 = Handlebars.compile(tp3);
        $.post("" + ServerIp + "/Teacher/SelectTeacher", {
                "tc_id": $("#tc_id").val(),
                "tc_name": $("#tc_name").val(),
                "tc_level": $("#tc_level").val(),
                "currentPage": currentPage,
            },
            function(data) {
                var pageSize = 0;
                var firstPage;
                var lastPage = 0;
                var pageList = $('#page-list');
                var tablebody = $('#tablebody');
                document.getElementById("tablebody").innerHTML = '';
                var data = JSON.parse(data);
                // alert(data);
                totalPage = data.body.totalPage;
                pageSize = data.body.pageSize;
                firstPage = data.body.firstPage;
                lastPage = data.body.lastPage;
                currentPage = data.body.currentPage;
                document.getElementById("page-list").innerHTML = '';
                if (lastPage) {
                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
                } else {
                    pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
                }
                pageList.append('<li><a id = "teacher' + totalPage + '" onclick="trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
                if (totalPage > 1) {
                    if (totalPage - currentPage >= 2) {
                        pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                    }
                    if (currentPage > 1 && currentPage != totalPage) {
                        pageList.append('<li ><a id = "teacher' + currentPage + '" chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
                        pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                    } else {
                        pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                    }
                    pageList.append('<li ><a id = "teacher' + 1 + '" chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
                }
                document.getElementById("teacher" + currentPage + "").style.background = "#426384";
                if (firstPage) {
                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
                } else {
                    pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
                }
                pageList.append('<input style="width:50px;height:30px;margin-top:5px;margin-right:20px;" id="page_num"></input>');
                pageList.append('<li onclick = "turing_page()"><a href="#">翻页</a></li>');
                var data = data.body
                table = $('#tch_tb').DataTable({
							
							data: data.data,
							"paging": false, //禁止分页
							retrieve: true, //实例化检索
							"columns": [
								{
									data: 'tc_id'
							    },
							    {
									data: 'tc_name'
							    },
							    {
									data: 'tc_password'
							    },
							    {
									data: 'tc_level'
							    },
								{
									data: null//占位空列
								} 
							],						
							"columnDefs": 
							[
								{
									"searchable": false,
									"orderable": false,
									"targets": [0. - 1]					// 表格填充的范围,[0,-1]为所有
								},
								{
									"targets": -1,
									"render": function(a, b, c, d) 
									{		
											var context =
											{
												func: 
												[
													{
														"name": "修改",
														"fn": "edit_tc(\'" + c.tc_id + "\',\'" + c.tc_name + "\',\'" + c.tc_password + "\',\'" + c.tc_level + "\')",
														"type": "primary"
														
													}, //添加按键     name为按键属性
												]
											};
											var html1 = template(context);
											
											var context2 = 
											{
												func: 
												[
													{
														"name": "删除",
														"fn": "delete_teacher(\'" + c.tc_id + "\')",
														"type": "danger"
													},
												]
											};						
											var html2 = template2(context2);
										if(c.tc_level == "管理员")return html1;
										else return html1 + html2;	
										
											
										
									}
								},
							]
							
						});
            });
    }
    $('#page-list').on("click", "#nextpage", function() {
        currentPage += 1;
        DestroyTable();
        myFunction();
    });
    $('#page-list').on("click", "#lastpage", function() {
        currentPage -= 1;
        DestroyTable();
        myFunction();
    });
    $('#page-list').on("click", "#teacher1", function() {
        currentPage = 1;
        DestroyTable();
        myFunction();
    });

    function turing_page() {
        if ($("#page_num").val() > totalPage || $("#page_num").val() == '' || !Number.isInteger(Number($("#page_num").val()))) {
            alert("页码有误");
            return;
        }
        currentPage = $("#page_num").val();
        DestroyTable();
        myFunction();
    }

    function trailerPage(totalPage) {
        currentPage = totalPage;
        DestroyTable();
        myFunction();
    }
    </script>
</body>

</html>