<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>考试后台管理系统</title>
    <!-- jQuery -->
    <script type="text/javascript" charset="utf8" src="../exam/js/jquery.js"></script>
    
    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script> 
    <script type="text/javascript" charset="utf8" src="../exam/js/bootstrap-datetimepicker.min.js"></script>
    
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- NProgress --> 
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <script src="../vendors/nprogress/nprogress.js"></script>
    
    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <script src="../vendors/iCheck/icheck.min.js"></script>
    
    <!-- Custom Theme  -->
    <link href="../build/css/custom.min.css" rel="stylesheet">
    <link href="../vendors/select2/dist/css/select2.min.css" rel="stylesheet">
    <script src="../build/js/custom.min.js"></script>
    <script src="../vendors/select2/dist/js/select2.full.min.js"></script>
    <script src="../exam/js/config.js"></script>
    <!--<script src="../exam/js/AuthorityManagement.js"></script>-->
    
    <!-- FastClick -->
    <script src="../vendors/fastclick/lib/fastclick.js"></script>
    
    <!--Datatables--> 
	<link rel="stylesheet" type="text/css" href="../exam/css/jquery.dataTables.css">
	<script type="text/javascript" charset="utf8" src="../exam/js/jquery.dataTables.js"></script>
	<script src="../exam/js/handlebars-v3.0.1.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/js/dataTables.bootstrap.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/js/jquery.dataTables.js"></script>
	
    <!--DatatablesButtons--> 
    <script type="text/javascript" charset="utf8" src="../exam/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/js/buttons.html5.min.js"></script>
	<script type="text/javascript" charset="utf8" src="../exam/js/buttons.print.min.js"></script>
	<link rel="stylesheet" href="../exam/css/buttons.dataTables.min.css">

    
    <style>
    table {
        *border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        border: 1px solid #ccc;
        text-decoration: none;
        table-layout: fixed;
    }

    .zebra td,
    .zebra th {
        padding: 10px;
        /*border-bottom: 1px solid #f2f2f2;*/
        border-left: 1px solid #ccc;
        border-top: 1px solid #ccc;
        text-align: center;
    }

    .zebra .alternate,
    .zebra tbody tr:nth-child(even) {
        background: #f5f5f5;
        box-shadow: 0 1px 0 rgba(255, 255, 255, .8) inset;
    }

    .zebra th {
        text-align: center;
        text-shadow: 0 1px 0 rgba(255, 255, 255, .5);
        border-bottom: 1px solid #ccc;
        background-color: #eee;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#f5f5f5), to(#eee));
        background-image: -webkit-linear-gradient(top, #f5f5f5, #eee);
        background-image: -moz-linear-gradient(top, #f5f5f5, #eee);
        background-image: -ms-linear-gradient(top, #f5f5f5, #eee);
        background-image: linear-gradient(top, #f5f5f5, #eee);
        filter: progid: DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#f5f5f5, endColorstr=#eee);
        -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#f5f5f5,endColorstr=#eee)";
    }
    /*.zebra th:first-child {
        border-radius: 6px 0 0 0;
        width: 50px;
    }*/

    .zebra th:last-child {
        border-radius: 0 6px 0 0;
        width: 120px;
    }

    .zebra tr:last-child td:first-child {
        border-radius: 0 0 0 6px;
    }

    .zebra td:last-child {
        border-radius: 0 0 6px 0;
    }

    .pageNumber {
        margin-top: 20px;
        padding: 10px;
        border-radius: 5px;
        background: #dddddd;
        height: 40px;
        width: auto;
    }

    td {
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
        text-align: center;
    }

    .td0 {
        width: 50%;
        text-align: left;
    }

    .td1 {
        width: 12%;
    }

    a {
        cursor: pointer;
    }
    </style>
    <style>
    ul.pagination {
        display: inline-block;
        padding: 0;
        margin: 0;
        float: right;
    }

    ul.pagination li {
        display: inline;
    }

    ul.pagination li a {
        color: black;
        float: right;
        padding: 8px 16px;
        text-decoration: none;
        transition: background-color .3s;
        border: 1px solid #ddd;
    }

    ul.pagination li a.active {
        background-color: #4CAF50;
        color: white;
        border: 1px solid #4CAF50;
    }

    ul.pagination li a:hover:not(.active) {
        background-color: #ddd;
    }
    </style>
    <script>
    </script>
</head>

<body class="nav-md"  style="background-image: url(../vendors/tushuguan.jpg);background-repeat: no-repeat;background-size: cover;">
    <div class="container body">
        <div class="main_container" >
            <div id="menu">
             <!--加载侧边栏-->
            </div>
            <div class="right_col" role="main">
                <div class="page-title">
                    <div class="title_left">
                        <h3>查看策略 </h3>
                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>查看策略</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="demo">
                                    <table id="strategy_table" class="zebra bulk_action" class=display>
                                        <!--<tr>
                                            <th>分数</th>
                                            <th>策略名称</th>
                                            <th>操作</th>
                                        </tr>-->
                                        <thead>
                                        	<tr>
                                        		<th class="td0">分数</th>
                                        		<th class="td0">策略名称</th>
                                        		<th class="td1">操作</th>
                                        	</tr>
                                        </thead>
                                        <tbody id="tablebody">
                                        </tbody>
                                    </table>
                                </div>
                                <div>
                                    <ul class="pagination" id="strategy_page-list">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div id="sgList" class="col-md-12 col-sm-12 col-xs-12" hidden>
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>查看策略项</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <br />
                                <form class="form-horizontal form-label-left col-md-5" style="float: left;">
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">题库选择</label>
                                        <div class="col-md-9">
                                            <select class="select2_single form-control" style="width: 100%;" id="qb_id">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">题型选择</label>
                                        <div class="col-md-9">
                                            <select class="form-control tixin" id="qt_type">
                                                <option value="choice">选择题</option>
                                                <option value="judge">判断题</option>
                                                <option value="fillb">程序填空题</option>
                                                <option value="filla">读程序写结果</option>
                                                <option value="coding">编程题</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">题目数量</label>
                                        <div class="col-md-9">
                                            <input id="sm_number" class="form-control" placeholder="题目数量" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-7 col-sm-6 col-xs-12">难度上下限取上不取下，如-10< x <=100</label>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">难度上限</label>
                                        <div class="col-md-9">
                                            <select class="form-control" id="qt_diffculty_up">
                                                <option value="100">100</option>
                                                <option value="90">90</option>
                                                <option value="80">80</option>
                                                <option value="70">70</option>
                                                <option value="60">60</option>
                                                <option value="50">50</option>
                                                <option value="40">40</option>
                                                <option value="30">30</option>
                                                <option value="20">20</option>
                                                <option value="10">10</option>
                                                <option value="0">0</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">难度下限</label>
                                        <div class="col-md-9">
                                            <select class="form-control" id="qt_diffculty_down">
                                                <option value="-10">-10</option>
                                                <option value="0">0</option>
                                                <option value="10">10</option>
                                                <option value="20">20</option>
                                                <option value="30">30</option>
                                                <option value="40">40</option>
                                                <option value="50">50</option>
                                                <option value="60">60</option>
                                                <option value="70">70</option>
                                                <option value="80">80</option>
                                                <option value="90">90</option>
                                                <option value="100">100</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12">知识点</label>
                                        <div class="col-md-9">
                                            <select class="form-control" id="knowledge">
                                                <option value="0">全部知识点</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3">题目分值</label>
                                        <div class="col-md-9">
                                            <input id="sm_score" class="form-control" placeholder="题目分值" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12 col-sm-9 col-xs-12 col-md-offset-5">
                                            <!--<button type="reset" class="btn btn-primary">重置</button>-->
                                            <button type="button" id="add" class="btn btn-success">添加</button>
                                        </div>
                                    </div>
                                </form>

                                <br />
                            </div>
                        </div>
                        <div class="demo col-md-12">
                                    <div class="form-group col-md-12">
                                        <label class="control-label col-md-2">总分：</label>
                                        <div class="col-md-3">
                                            <label class="control-label col-md-2" id="total_score"></label>
                                        </div>
                                    </div>
                                    <div class="demo">
                                        <table id="strategy_item" class="zebra bulk_action" class=display>
                                            <!--<tr>
                                                <th style="width:35%">题库</th>
                                                <th>类型</th>
                                                <th>难度上限</th>
                                                <th>难度下限</th>
                                                <th>分数</th>
                                                <th>数量</th>
                                                <th>范围</th>
                                                <th>删除</th>
                                            </tr>-->
                                            <thead>
                                            	<tr>
                                            		<th style="width:35%">题库</th>
                                            		<th>类型</th>
                                            		<th>难度上限</th>
	                                                <th>难度下限</th>
	                                                <th>分数</th>
	                                                <th>数量</th>
	                                                <th>范围</th>
	                                                <th>操作</th>
                                            	</tr>
                                            </thead>
                                            <tbody id="my_body">
                                            </tbody>
                                        </table>
                                    </div>
                                    <div>
                                        <ul class="pagination" id="page-list">
                                        </ul>
                                    </div>
                                </div>
                                <br />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /page content -->
    </div>
    </div>
   <!--定义操作列按钮模板-->
	<script id="tpl" type="text/x-handlebars-template">
	    {{#each func}}
	    <button type="button" class="btn btn-{{this.type}} btn-sm" onclick="{{this.fn}}">{{this.name}}</button>
	    {{/each}}
	</script>
	<script id="tp2" type="text/x-handlebars-template">
	    {{#each func}}
	    <button type="button" class="btn btn-{{this.type}} btn-sm" onclick="{{this.fn}}">{{this.name}}</button>
	    {{/each}}
	</script>
	<script id="tp3" type="text/x-handlebars-template">
	    {{#each func}}
	    <button type="button" class="btn btn-{{this.type}} btn-sm" onclick="{{this.fn}}">{{this.name}}</button>
	    {{/each}}
	</script>
	<script src="../exam/js/menu.js"></script>
        
    <script type="text/javascript">
    	$(function () 
		 {
    		$.ajax
			({
	      	    url: "" + ServerIp + "/StudentManage/Menu", //加上这句话
	            type: 'POST',				//请求的类型
	            async: false,
	            dataType: "text",			//数据类型		          
	            data: {					         		            
	            },					            
	            success:function(data) 	 //操作后台的返回值
	            {
	            	//alert(data);
	            	data = JSON.parse(data);		           
	            	$("#menu").append(data);		            	
				},
	            error: function(e)
	            {
	            	alert("error");
	            }
		    });
		})
    </script>
	
    <script>
    $(document).ready(function() {
        $(".select2_single").select2({
            placeholder: "请选择题库",
            allowClear: true
        });
        $(".select2_group").select2({});
    });
    </script>
    <script>
    var strategy_sg_id;
    var currentPage = 1;
    var strategy_currentPage = 1;
    var totalPage=0;

	function DestroyTable1()//清除查看策略datatable表格内容以供刷新
        {
        	var datatable = $("#strategy_table").dataTable();
        	if (datatable) 
        	{
	         	datatable.fnClearTable();    //清空数据
	         	datatable.fnDestroy();         //销毁datatable
       	 	} 

        }

	function DestroyTable2()//清除策略项datatable表格内容以供刷新
        {
        	var datatable = $("#strategy_item").dataTable();
        	if (datatable) 
        	{
	         	datatable.fnClearTable();    //清空数据
	         	datatable.fnDestroy();         //销毁datatable
       	 	} 

        }

    //删除策略项
    function deleteItem(sm_id) {
        <!--alert(data.className);-->
        $.post(""+ServerIp+"/StrategyManage/DelStrategyTerm", {
                sm_id: sm_id
            },
            function(data) {
                try {
                    data = JSON.parse(data);
                    if (data.status == 1) {
                    	DestroyTable2();
                        myfunction();
                    }
                } catch (e) {

                }
            }
        )
    }
	
	//查看按钮
//  function lookSg(data) {
//      strategy_sg_id = data.className;
//      $("#sgList").show();
//      myfunction();
//  }
	function lookSg(sg_id) {
        strategy_sg_id = sg_id;
        $("#sgList").show();
        DestroyTable2();
        myfunction();
    }

	//点击查看后弹出的表格即策略项表格
	function myfunction()
	{
		//定义按钮模板
	    var tp3 = $("#tpl").html();		    
		//预编译模板
        var template = Handlebars.compile(tp3);
		$.ajax({
			url: "" + ServerIp + "/StrategyManage/GetStrategyTerm",
			type: 'POST', //请求的类型
			async: false,
			dataType: "text", //数据类型
			data: { "strategy_sg_id": strategy_sg_id,
            		"currentPage": currentPage
			},
			success: function(data) //操作后台的返回值
			{	var pageList = $('#page-list');
				data = JSON.parse(data);				
				//alert(data.data);
				if (data.status == 1) {
                totalPage = data.body.totalPage;
                var firstPage = data.body.firstPage;
                var lastPage = data.body.lastPage;
                var currentPage = data.body.currentPage;
                document.getElementById("my_body").innerHTML = '';
                document.getElementById("total_score").innerHTML = data.body.message;
                } else {
                // <!--alert('Oh, No!');-->
                alert(data.body);
	            }
	            document.getElementById("page-list").innerHTML = '';
	            if (lastPage) {
	                pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
	            } else {
	                pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
	            }
	            pageList.append('<li><a id = "sm' + totalPage + '" onclick="trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
	            if (totalPage > 1) {
	                if (totalPage - currentPage >= 2) {
	                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
	                }
	                if (currentPage > 1 && currentPage != totalPage) {
	                    pageList.append('<li ><a id = "sm' + currentPage + '" chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
	                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
	                } else {
	                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
	                }
	                pageList.append('<li ><a id = "sm' + 1 + '" chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
	            }
	            document.getElementById("sm" + currentPage).style.background = "#426384";
	            if (firstPage) {
	                pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
	            } else {
	                pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
	            }
	            pageList.append('<input style="width:50px;height:30px;margin-top:5px;margin-right:20px;" id="page_num"></input>');
	            pageList.append('<li onclick = "turing_page()"><a href="#">翻页</a></li>');
                data = data.body;
	           	table = $('#strategy_item').DataTable({
					dom: 'Bfrtip',
					data: data.data,
					"paging": false, //禁止分页
					retrieve: true, //实例化检索
					"columns": [
						{
							data: 'qb_name'
					    },
					    {
							data: 'sm_type'
					    },	
					    {
							data: 'sm_difficulty_high'
					    },
						{
							data: 'sm_difficulty_low'
					    },
					    {
							data: 'sm_score'
					    },
					    {
							data: 'sm_number'
					    },
					    {
							data: 'kl_name'
					    },
						{
							data: null//占位空列
						} 

					],
					"columnDefs": [{
							"searchable": false,
							"orderable": false,
							"targets": [0. - 1]					// 表格填充的范围,[0,-1]为所有
						},
						{
							"targets": 7,
							"render": function(a, b, c, d) {
									 var context1 =
			                        {
			                            func: [
			                                {"name": "删除", "fn": "deleteItem(\'" + c.sm_id + "\')", "type": "danger"},
			                                
			                            ]
			                        };
			                        var html1 = template(context1);			                        			                        
			                        return html1;
							}
						},
					]
				});
				
			}
		});
	}
//  function myfunction() {
//      var pageList = $('#page-list');
//      $.post(""+ServerIp+"/StrategyManage/GetStrategyTerm", {
//          "strategy_sg_id": strategy_sg_id,
//          "currentPage": currentPage
//      }, function(data) {
//          data = JSON.parse(data);
//          if (data.status == 1) {
//              totalPage = data.body.totalPage;
//              var firstPage = data.body.firstPage;
//              var lastPage = data.body.lastPage;
//              var currentPage = data.body.currentPage;
//              document.getElementById("my_body").innerHTML = '';
//              document.getElementById("total_score").innerHTML = data.body.message;
//              var i = 0;
//              while (data.body.data[i]) {
//                  $('#my_body').append('<tr><td>' + data.body.data[i].qb_name + '</td><td>' + data.body.data[i].sm_type + '</td><td>' + data.body.data[i].sm_difficulty_high + '</td><td>' + data.body.data[i].sm_difficulty_low + '</td><td>' + data.body.data[i].sm_score + '</td><td>' + data.body.data[i].sm_number + '</td><td>' + data.body.data[i].kl_name + '</td><td><a href="#" class="' + data.body.data[i].sm_id + '" onclick = "deleteItem(this)" >删除</a></td></tr>');
//                  i++;
//              }
//          } else {
//              // <!--alert('Oh, No!');-->
//              alert(data.body);
//          }
//          document.getElementById("page-list").innerHTML = '';
//          if (lastPage) {
//              pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
//          } else {
//              pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
//          }
//          pageList.append('<li><a id = "sm' + totalPage + '" onclick="trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
//          if (totalPage > 1) {
//              if (totalPage - currentPage >= 2) {
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              }
//              if (currentPage > 1 && currentPage != totalPage) {
//                  pageList.append('<li ><a id = "sm' + currentPage + '" chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              } else {
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              }
//              pageList.append('<li ><a id = "sm' + 1 + '" chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
//          }
//          document.getElementById("sm" + currentPage).style.background = "#426384";
//          if (firstPage) {
//              pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
//          } else {
//              pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
//          }
//          pageList.append('<input style="width:50px;height:30px;margin-top:5px;margin-right:20px;" id="page_num"></input>');
//          pageList.append('<li onclick = "turing_page()"><a href="#">翻页</a></li>');
//      });
//  }
    $('#page-list').on("click", "#nextpage", function() {
        currentPage += 1;
        DestroyTable2();
        myfunction();
    });
    $('#page-list').on("click", "#lastpage", function() {
        currentPage -= 1;
        DestroyTable2();
        myfunction();
    });
    $('#page-list').on("click", "#sm1", function() {
        currentPage = 1;
        DestroyTable2();
        myfunction();
    });
    function turing_page() {
            if ($("#page_num").val() > totalPage || $("#page_num").val() == '' || !Number.isInteger(Number($("#page_num").val()))) {
                alert("页码有误");
                return;
            }
            currentPage = $("#page_num").val();
            myFunction();

        }

    function trailerPage(totalPage) {
        currentPage = totalPage;
        DestroyTable2();
        myfunction();
    }

	//添加策略按钮
    $('#add').click(function() {
        if (parseInt($('#qt_diffculty_up').val()) < parseInt($('#qt_diffculty_down').val())) {
            alert('难度上限小于难度下限');
            return false;
        }
        if ($('#sm_number').val()==""|| !Number.isInteger(parseInt($("#sm_number").val()))) {
            alert('题目数量错误');
            return false;
        }
        if ($('#sm_score').val()==""|| !Number.isInteger(Number($("#sm_score").val()))) {
            alert('题目分数错误');
            return false;
        }
        var pageList = $('#page-list');
        $.post(""+ServerIp+"/StrategyManage/CreatStrategyTerm", {
            "qb_id": $('#qb_id').val(),
            "sm_type": $('#qt_type').val(),
            "sm_difficulty_high": $('#qt_diffculty_up').val(),
            "sm_difficulty_low": $('#qt_diffculty_down').val(),
            "sm_knowledge": $('#knowledge').val(),
            "sm_number": document.getElementById('sm_number').value,
            "sm_score": document.getElementById('sm_score').value,
            "strategy_sg_id": strategy_sg_id,
            "currentPage": currentPage
        }, function(data) {
            data = JSON.parse(data);
            if (data.status == 1) {
                var totalPage = data.body.totalPage;
                var firstPage = data.body.firstPage;
                var lastPage = data.body.lastPage;
                // var currentPage = data.body.currentPage;
                document.getElementById("my_body").innerHTML = '';
                document.getElementById("total_score").innerHTML = data.body.message;
                var i = 0;
                while (data.body.data[i]) {
                    $('#my_body').append('<tr><td>' + data.body.data[i].qb_name + '</td><td>' + data.body.data[i].sm_type + '</td><td>' + data.body.data[i].sm_difficulty_high + '</td><td>' + data.body.data[i].sm_difficulty_low + '</td><td>' + data.body.data[i].sm_score + '</td><td>' + data.body.data[i].sm_number + '</td><td>' + data.body.data[i].kl_name + '</td><td><a href="#" class="' + data.body.data[i].sm_id + '" onclick = "deleteItem(this)" >删除</a></td></tr>');
                    i++;
                }
                document.getElementById("page-list").innerHTML = '';
                if (lastPage) {
                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
                } else {
                    pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
                }
                pageList.append('<li><a id = questionback' + totalPage + ' onclick="trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
                if (totalPage > 1) {
                    if (totalPage - currentPage >= 2) {
                        pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                    }
                    if (currentPage > 1 && currentPage != totalPage) {
                        pageList.append('<li ><a id = questionback' + currentPage + ' chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
                        pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                    } else {
                        pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
                    }
                    pageList.append('<li ><a id = questionback' + 1 + ' chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
                }
                document.getElementById("questionback" + currentPage).style.background = "#426384";
                if (firstPage) {
                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
                } else {
                    pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
                }
            } else {
                // <!--alert('Oh, No!');-->
                alert(data.body);
                alert(data.message);       }
        });
    });
    $(document).ready(function() {
        DestroyTable1();
        myfunction1();
        var knowledge = $("#knowledge");
        var qb = $("#qb_id");
        $.get(""+ServerIp+"/QuestionBackManage/RequestQuestionBack/", {}, function(data) {
            var data = JSON.parse(data);
            for (var i = 0; i < data.body[0].length; i++) {
                knowledge.append("<option value = '" + data.body[0][i].kl_id + "'>" + data.body[0][i].kl_name + "</option>");
            }
            for (var i = 0; i < data.body[1].length; i++) {
                qb.append("<option value = '" + data.body[1][i].qb_id + "'>" + data.body[1][i].qb_name + "</option>");
            }
        });
    });
	
	//查看策略表格(第一个表格)
	function myfunction1()
	{
		//定义按钮模板
		    var tpl = $("#tpl").html();
		    var tp2 = $("#tp2").html();
			//预编译模板
	        var template = Handlebars.compile(tpl);
	        var template = Handlebars.compile(tp2);
			$.ajax({
				url: "" + ServerIp + "/StrategyManage/SelectStrategy",
				type: 'POST', //请求的类型
				async: false,
				dataType: "text", //数据类型
				data: {"currentPage": strategy_currentPage
				},
				success: function(data) //操作后台的返回值
				{	
					data = JSON.parse(data);
					data = data.body;
					//alert(data.data);
		            var tablebody = $('#tablebody');
		            document.getElementById("tablebody").innerHTML = '';
		            var totalPage = data.totalPage;
		            var firstPage = data.firstPage;
		            var lastPage = data.lastPage;
		            var currentPage = data.currentPage;
		            pageList = $("#strategy_page-list");
		            document.getElementById("strategy_page-list").innerHTML = '';
		            if (lastPage) {
		                pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
		            } else {
		                pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
		            }
		            pageList.append('<li><a id = target' + totalPage + ' onclick="target_trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
		            if (totalPage > 1) {
		                if (totalPage - currentPage >= 2) {
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                }
		                if (currentPage > 1 && currentPage != totalPage) {
		                    pageList.append('<li ><a id = "target' + currentPage + '" chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                } else {
		                    pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
		                }
		                pageList.append('<li ><a id = "target' + 1 + '" chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
		            }
		            document.getElementById("target" + currentPage).style.background = "#426384";
		            if (firstPage) {
		                pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
		            } else {
		                pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
		            }
					table = $('#strategy_table').DataTable({
						dom: 'Bfrtip',
						data: data.data,
						"paging": false, //禁止分页
						retrieve: true, //实例化检索
						"columns": [
							{
								data: 'sg_score'
						    },
						    {
								data: 'sg_name'
						    },	
							{
								data: null//占位空列
							} 

						],
						"columnDefs": [{
								"searchable": false,
								"orderable": false,
								"targets": [0. - 1]					// 表格填充的范围,[0,-1]为所有
							},
							{
								"targets": 2,
								"render": function(a, b, c, d) {
										 var context1 =
				                        {
				                            func: [
				                                {"name": "查看", "fn": "lookSg(\'" + c.sg_id + "\')", "type": "primary"},
				                                
				                            ]
				                        };
				                        var html1 = template(context1);
				                        
				                        var context2 =
				                        {
				                            func: [
				                                {"name": "删除", "fn": "deleteSg(\'" + c.sg_id + "\')", "type": "danger"},		//添加按键     name为按键属性
				                                
				                            ]
				                        };
				                        var html2 = template(context2);
				                        return html1+html2;
								}
							},
						]
					});
					
				}
			});
	}
//  function myfunction1() {
//      $.post(""+ServerIp+"/StrategyManage/SelectStrategy", {
//          "currentPage": strategy_currentPage
//      }, function(data) {
//          var data = JSON.parse(data);
//          var tablebody = $('#tablebody');
//          document.getElementById("tablebody").innerHTML = '';
//          var totalPage = data.body.totalPage;
//          var firstPage = data.body.firstPage;
//          var lastPage = data.body.lastPage;
//          var currentPage = data.body.currentPage;
//          var i = 0;
//          var str = '';
//          try {
//              while (data.body.data[i]) {
//                  str = `<tr>
//                                      <td>` + data.body.data[i].sg_score + `</td>
//                                      <td>` + data.body.data[i].sg_name + `</td>
//                                      <td><a style="margin-right: 10px;" class=` + data.body.data[i].sg_id + `  onclick="lookSg(this)">查看</a><a   class=` + data.body.data[i].sg_id + ` onclick="deleteSg(this)">删除</a></td>
//                                  </tr>`
//                  tablebody.append(str);
//                  i += 1;
//              }
//          } catch (err) {}
//          pageList = $("#strategy_page-list");
//          document.getElementById("strategy_page-list").innerHTML = '';
//          if (lastPage) {
//              pageList.append('<li><a style="color: #777;cursor: not-allowed;">下页</a></li>')
//          } else {
//              pageList.append('<li id = "nextpage"><a href="#">下页</a></li>');
//          }
//          pageList.append('<li><a id = target' + totalPage + ' onclick="target_trailerPage(' + totalPage + ')" href="#"style="background: wight;" >  ' + totalPage + '</a></li>');
//          if (totalPage > 1) {
//              if (totalPage - currentPage >= 2) {
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              }
//              if (currentPage > 1 && currentPage != totalPage) {
//                  pageList.append('<li ><a id = "target' + currentPage + '" chref="#"style="background: wight;" >  ' + currentPage + '</a></li>');
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              } else {
//                  pageList.append('<li><a style="color: #777;cursor: not-allowed;">....</a></li>');
//              }
//              pageList.append('<li ><a id = "target' + 1 + '" chref="#"style="background: wight;" >  ' + 1 + '</a></li>');
//          }
//          document.getElementById("target" + currentPage).style.background = "#426384";
//          if (firstPage) {
//              pageList.append('<li><a style="color: #777;cursor: not-allowed;">上页</a></li>')
//          } else {
//              pageList.append('<li id = "lastpage"><a chref="#">上页</a></li>');
//          }
//      });
//  }
    $('#strategy_page-list').on("click", "#nextpage", function() {
        strategy_currentPage += 1;
        DestroyTable1();
        myfunction1(); 
    });
    $('#strategy_page-list').on("click", "#lastpage", function() {
        strategy_currentPage -= 1;
        DestroyTable1();
        myfunction1();
    });
    $('#strategy_page-list').on("click", "#target1", function() {
        strategy_currentPage = 1;
        DestroyTable1();
        myfunction1();
    });

    function target_trailerPage(totalPage) {
        strategy_currentPage = totalPage;
        DestroyTable1();
        myfunction1();
    }
    
    //删除策略
    function deleteSg(sg_id){
    	//alert(sg_id);
        var password = prompt('请输入管理员密码', '');
        if (password == '' || typeof(password) == 'undefined' || password == null) {
            alert('您输入的管理员密码有误');
        } else {
            $.post("" + ServerIp + "/StrategyManage/DelStrategy", {
                "sg_id": sg_id,
                "deletepassword": password
            }, function(data) {
                var data = JSON.parse(data);
                //alert(data.status);
                if (data.status == 1)
                    alert('删除成功');
                else
                    alert(data.message);
                DestroyTable1();
                myfunction1();
            });
        }
    }
    </script>
</body>

</html>